import{m as R,a,G as y,j as h,Q as L,b as I,J,c as N}from"./index-Dn2gZVVt.js";var j=function(i,n){return new Promise(function(v,r){if(typeof XMLHttpRequest<"u"){var d=R.of(i),o=d.dispatcher,w=d.logger,c=n.requestId,E=n.method,b=n.url,u=n.headers,f=u===void 0?{}:u,p=n.data,x=p===void 0?"":p,l=n.uploadProgressHandler,m=!1,e=new XMLHttpRequest;e.open(E,b),Object.keys(f).forEach(function(t){e.setRequestHeader(t,f[t])}),l&&e.upload.addEventListener("progress",function(t){t.lengthComputable?l(c,t.loaded,t.total):w.debug("Progress computing failed: `Content-Length` header is not given.")}),e.onabort=function(){r(a.requestCanceled)},e.onerror=function(t){r(a.networkError)},e.onreadystatechange=function(){if(e.readyState===XMLHttpRequest.DONE&&!m)if(e.status===0||e.status>=200&&e.status<400)try{var t=JSON.parse(e.responseText);v(new y(i,t))}catch{r(a.networkError)}else try{var g=JSON.parse(e.responseText);if(g){var s=new a(g);if(s.isSessionExpiredError){if(o.dispatch(new h({reason:s.code,message:s.message})),!(e instanceof L)){var q=new I;return o.dispatch(new J({request:e,deferred:q,error:s})),q.promise}}else s.isSessionInvalidatedError&&o.dispatch(new h({reason:s.code,message:s.message}));r(s)}else r(a.requestFailed)}catch{r(a.requestFailed)}},o.on(function(t){t instanceof N&&(t.requestId&&t.requestId!==c||(m=!0,e.abort()))}),e.send(x)}else r(a.xmlHttpRequestNotSupported)})};export{j as xmlHttpRequest};
